<!DOCTYPE HTML>
<!--
    Twenty by HTML5 UP
    html5up.net | @ajlkn
    Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
<head>
    <title>Treeternity - Volunteer and choose epoxy based alternatives.  Trees blissfully dancing eternally.</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!--[if lte IE 8]><script src="static/js/ie/html5shiv.js"></script><![endif]-->
    <link rel="stylesheet" href="static/css/main.css" />
    <!--[if lte IE 8]><link rel="stylesheet" href="static/css/ie8.css" /><![endif]-->
    <!--[if lte IE 9]><link rel="stylesheet" href="static/css/ie9.css" /><![endif]-->
    <style>
        /*div#treeDiv {
            background-color: rgba(0,0,0,0.5);
        }*/

        .gmnoprint.gm-bundled-control.gm-bundled-control-on-bottom {
            display: table !important;
            width: 49px !important;
            height: 48px !important;
            right: 0px !important;
            bottom: 11px !important;
        }

        @media (max-width : 845px) {
            .address {
                width: 100% !important;
                float: none !important;
                margin-bottom: 15px;
            }

            .address_street {
                width: 100%;
                min-width: 100%;
                float: none !important;
                text-align: center;
            }
        }

        .gmnoprint > div[draggable~=false],
        button[title~=Zoom] {
            display: none !important;
        }

        .gm-iv-address, button.gm-control-active.gm-fullscreen-control {
            display: none !important;
        }
        .comdiv{
            float:left;
            height:100%;
            position: relative;
            min-height: 1px;
            padding-right: 15px;
            padding-left: 15px;
             -webkit-box-sizing: border-box;
            -moz-box-sizing: border-box;
            box-sizing: border-box;
        }
        #treeDiv{
            -webkit-box-sizing: border-box;
            -moz-box-sizing: border-box;
            box-sizing: border-box;
        }

        /*.comdiv1{background-color:#ff0000}
        .comdiv2{background-color: #ff6a00}
        .comdiv3{background-color: #ffd800}
        .comdiv4{background-color: #d51edd}
        .comdiv5{background-color: #00ff21}
        .comdiv6{background-color: #808080}
        .comdiv7{background-color: #2986ea}*/
    </style>

    <!-- Scripts -->
    <script src="static/js/jquery.min.js"></script>
    <script src="static/js/jquery.dropotron.min.js"></script>
    <script src="static/js/jquery.scrolly.min.js"></script>
    <script src="static/js/jquery.scrollgress.min.js"></script>
    <script src="static/js/skel.min.js"></script>
    <script src="static/js/util.js"></script>
    <!--[if lte IE 8]><script src="static/js/ie/respond.min.js"></script><![endif]-->

</head>
<body class="index">
    <div id="page-wrapper">

        <!-- Header -->
        <header id="header" class="alt">
            <h1 id="logo"><a href="index.html">Treeternity <span>eternal bliss for every tree</span></a></h1>
            <nav id="nav">
                <ul>
                    <li><a href="#" class="button special">Plant</a></li>
                </ul>
            </nav>
        </header>
        <section id="banner" style='position:relative;'>
            <div class="bannerimg"></div>
            <div style='position: absolute; top: 75px; left: 0px; width: 100%; height: 340px; display:none;' id='map'>
            </div>
            <div style='position: absolute; top:0; bottom:0; left:0; right:0; z-index: 0' id='pano'>
            </div>

            <div id="treeDivWrap" style="position: absolute; top:0; bottom:20px; left: 0; right: 60px; z-index: 5000;display:flex">
                <div style="position:relative;overflow:hidden;width: 100%;">
                    <div id='treeDiv' style="position:absolute;left: 0;bottom: 0;top: 0;width: 100%;">
                            <div id="slide1" class="comdiv comdiv1"></div>
                            <div id="slide2" class="comdiv comdiv2"></div>
                            <div id="slide3" class="comdiv comdiv3"></div>
                            <div id="slide4" class="comdiv comdiv4"></div>
                            <div id="slide5" class="comdiv comdiv5"></div>
                            <div id="slide6" class="comdiv comdiv6"></div>
                            <div id="slide7" class="comdiv comdiv7"></div>
                    </div>
                </div>

            </div>


            <div id="floating-panel" style='display: none;'>
                <table style="padding-left: 15px; margin-top: 20px">
                    <tr>
                        <td><b>Position</b></td>
                        <td id="position-cell">&nbsp;</td>
                    </tr>
                    <tr>
                        <td><b>Latitude</b></td>
                        <td id="lat-cell">&nbsp;</td>
                    </tr>
                    <tr>
                        <td><b>Longitude</b></td>
                        <td id="lng-cell">&nbsp;</td>
                    </tr>
                    <tr>
                        <td><b>Heading:</b></td>
                        <td id="heading-cell">270</td>
                    </tr>
                    <tr>
                        <td><b>Pitch:</b></td>
                        <td id="pitch-cell">0.0</td>
                    </tr>
                    <tr>
                        <td><b>Location ID</b></td>
                        <td id="location-cell"></td>
                    </tr>
                    <tr style="display: none">
                        <td><b>Pano ID</b></td>
                        <td id="pano-cell">&nbsp;</td>
                    </tr>


                    Location
                    <table id="links_table"></table>
                </table>
            </div>



            <div class='address' style='position:relative;z-index: 5002;padding:10px;width: 620px;margin: 0px auto;'>
                <div class='inner'>
                    <header>
                        <h2 style='padding-bottom: 5px;'>Plant a tree</h2>
                    </header>
                    <form>
                        <input id="address" placeholder="Enter your address" type="text" name="address">

                        <!--<input id="submit" type="button" value="Plant a virtual tree" style="" onclick='submit_button(); return false;' />-->

                        <input id="submit" type="button" value="Plant a virtual tree" style="" />
                    </form>

                </div>
            </div>

            <div style='clear:both;'></div>
        </section>
    </div>




    <input type="hidden" id="whatposition" />
    <input type="hidden" id="lastval" />
    <footer id="footer">

        <ul class="icons">
            <li><a href="https://github.com/treeternity/treeternity/blob/master/static/3d/ATTRIBUTION.md" class="icon circle fa-github"><span class="label">Attribution</span></a></li>
        </ul>

        <ul class="copyright">
            <li>&copy; Tree.to</li>
            <li>Design: <a href="http://html5up.net">HTML5 UP</a>. </li>
        </ul>

        <ul class="copyright">
            <li><p>Plant a little love in every place by a few volunteers with abundant love. Peace and love :)</p></li>
        </ul>

    </footer>



    <script src="static/js/main.js"></script>

    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDwv3jzb9Cc4QD9pRhwgeL4pz8WX6DRpLE&signed_in=true&callback=initMap" async defer></script>


    <!--<script type="text/javascript" src="static/js/streetviewpoc.js"></script>-->
    <!-- 3ds -->
    <!--https://developers.google.com/maps/documentation/javascript/examples/streetview-events-->
    <script src="static/js/jquery.mousewheel.js"></script>
    <script src="static/js/three.min.js"></script>
    <script src="static/js/TDSLoader.js"></script>
    <script src="static/js/Detector.js"></script>
    <script src="static/js/streetviewoverlay.js"></script>

    <!-- map -->

    <script type="text/javascript">
        $(document).ready(function () {
            $("#treeDiv div").hide();
                localStorage.clear();
                var hiddentxt = document.getElementById("whatposition");
                var hiddentxt2 = document.getElementById("lastval");
                var wrapperdiv = document.getElementById("treeDivWrap").clientWidth;
                $(".comdiv").css("width", wrapperdiv + "px")
               // alert(wrapperdiv);

                var totalwidth = parseFloat(wrapperdiv) * 7;
                var leftPO = parseFloat(wrapperdiv) * 4;

                var forcenter = totalwidth - leftPO;

                var scrollingDiv = document.getElementById("treeDiv")
                scrollingDiv.style.width = totalwidth + "px";
                scrollingDiv.style.left = "-" + forcenter + "px";
                hiddentxt.value = forcenter;
                hiddentxt2.value = forcenter;

                // JSON

                jsonObj = [];
                var i = 0;

                $("#treeDiv div").click(function (e) {
                    var lat = document.getElementById("lat-cell").innerHTML;
                    var long = document.getElementById("lng-cell").innerHTML;
                    var headi = document.getElementById("heading-cell").innerHTML;
                    var pit = document.getElementById("pitch-cell").innerHTML;
                    var loca = document.getElementById("location-cell").innerHTML;
                    var divid = $(this).attr('id');
                    var area = "";
                    area = $("#address").val();
                    var numTree = i++;
                    var posX = $(this).offset().left, posY = $(this).offset().top;
                    var toppo = e.pageY - 205;
                    var leftpo = e.pageX - 75;

                    $("#" + divid).append("<img src='static/3d/tree_1.png' style='position: absolute; top:" + toppo + "px;" + " width:150px; left:" + leftpo + "px;" + "right: 70px; z-index: 5000;' alt='tree'/>");
                    item = {}
                    item["divId"] = divid;
                    item["treeNo"] = numTree;
                    item["treeFromViewportTop"] = toppo;
                    item["treeFromViewportLeft"] = leftpo;
                    item["latitude"] = lat;
                    item["longitude"] = long;
                    item["heading"] = headi + "%";
                    item["pitch"] = pit;
                    item["location"] = loca;
                    jsonObj.push(item);
                    console.log(jsonObj); // here you will get the json of numbers of trees and there positions;
                    localStorage.setItem(area, JSON.stringify(jsonObj));
                    return false;
                });




            })
    </script>

    <script type="text/javascript">
        var map;
        var panorama;
        var sv;
        var initPosition = { lat: 39.7392, lng: -104.9903 };
        var streetviewLocation;




        function initMap() {
            var map = new google.maps.Map(document.getElementById('map'), {
                zoom: 13,
                center: initPosition,
                gestureHandling: 'none',
                zoomControl: false,
                mapTypeControl: false,
                scaleControl: false,
                streetViewControl: false,
                fullscreenControl: false
            });

            map.addListener('click', function (e) {
               // // // alert(e.latLng, map);

            });

            var geocoder = new google.maps.Geocoder();
            //function submit_button () {
            //    geocodeAddress(geocoder, map);
            //    return false;
            //}
            document.getElementById('submit').addEventListener('click', function (e) {
                geocodeAddress(geocoder, map);
                $("#treeDiv div").show();

                $(".bannerimg").animate({ opacity: '0' }, "800").delay(800).hide();
                // // debugger;
                // // debugger;
                var countpluse = 0;
                var countsub = 0;
                $(".gmnoprint.gm-bundled-control.gm-bundled-control-on-bottom .gm-compass button").click(function () {
                    var btn = $(this).attr("jstcache");
                    var wrapperdiv = document.getElementById("treeDivWrap").clientWidth;

                    if (btn == 40) {
                        countsub++
                        var hiddentxtval = document.getElementById("whatposition").value;
                        var wrapperdiv = document.getElementById("treeDivWrap").clientWidth;
                        var scrollingDiv = document.getElementById("treeDiv");
                        setTimeout(function () {

                            if (countsub <= 3) {
                                var addvalues = parseFloat(hiddentxtval) - parseFloat(wrapperdiv);

                                var tostring = addvalues.toString()
                                var n = tostring.search("-");
                                // debugger;
                                if (n == 0) {
                                    var mystring = tostring.replace(/-/g, "");
                                    $("#treeDiv").animate({ left: "-" + mystring + "px" }, 1000);
                                    hiddentxtval.value = mystring;
                                } else {

                                    $("#treeDiv").animate({ left: "-" + tostring + "px" }, 1000);
                                    document.getElementById("whatposition").value = tostring;
                                }


                            }

                            if (countsub == 4) {
                                var last = document.getElementById("lastval").value;
                                document.getElementById("whatposition").value = last;
                                $("#treeDiv").css("left", "");
                                $("#treeDiv").css("opacity", "0");
                                // $("#treeDiv").css("left", "-" + last + "px");
                                $("#treeDiv").animate({ left: "-" + last + "px", opacity:1 }, 1000);
                                countsub = 0;
                            }
                        }, 50);

                    }

                    if (btn == 41) {
                        countpluse++;
                        var hiddentxtval = document.getElementById("whatposition").value;
                        var wrapperdiv = document.getElementById("treeDivWrap").clientWidth;
                        setTimeout(function () {

                        var scrollingDiv = document.getElementById("treeDiv");
                        if (countpluse <= 3) {
                           // alert("hiddentxtval " + hiddentxtval);
                            var addvalues = parseFloat(hiddentxtval) + parseFloat(wrapperdiv);
                            var tostring = addvalues.toString()
                            var n = tostring.search("-");

                            if (n == 0) {
                                var mystring = tostring.replace(/-/g, "");
                                $("#treeDiv").animate({ left: "-" + mystring + "px" }, 1000);
                                document.getElementById("whatposition").value = mystring;
                            } else {

                                $("#treeDiv").animate({ left: "-" + tostring + "px" }, 1000);
                                document.getElementById("whatposition").value = tostring;
                            }
                        }

                        if (countpluse == 4) {
                            var last = document.getElementById("lastval").value;
                            document.getElementById("whatposition").value = last;
                            $("#treeDiv").css("left", "");
                           // $("#treeDiv").css("left", "-" + last + "px");
                            $("#treeDiv").animate({ left: "-" + last + "px" }, 1000);
                            countpluse = 0;
                        }
                        }, 100);
                    }

                });


                jsonObj = [];
                jsonObj.length = 0;
                //  console.log(jsonObj);
                $("#treeDiv div").empty();

                var last = document.getElementById("lastval").value;
                document.getElementById("whatposition").value = last;
                $("#treeDiv").css("left", "-" + last + "px");

                var areatosearch = $("#address").val();
                var previouTrees = localStorage.getItem(areatosearch)
                if (previouTrees !== null) {
                    var obj = jQuery.parseJSON(previouTrees);
                    $.each(obj, function (key, value) {
                        // // alert(key + ":" + value);
                        $("#" + value.divId).append("<img src='static/3d/tree_1.png' style='position: absolute; top:" + value.treeFromViewportTop + "px;" + " width:150px; left:" + value.treeFromViewportLeft + "px;" + "right: 70px; z-index: 5000;' alt='tree'/>");
                    });

                } else {
                    // //// // alert(2);
                }


            });

            sv = new google.maps.StreetViewService();
            panorama = new google.maps.StreetViewPanorama(document.getElementById('pano'));
            addPanoramaListener(panorama);
            panorama.setPosition(initPosition);
        }

        function addPanoramaListener(panoramaObject) {

           // // // alert(panoramaObject);
            panorama.addListener('pano_changed', function () {
                var panoCell = document.getElementById('pano-cell');
                panoCell.innerHTML = panorama.getPano();
            });
            panorama.addListener('links_changed', function () {
                var linksTable = document.getElementById('links_table');
                while (linksTable.hasChildNodes()) {
                    linksTable.removeChild(linksTable.lastChild);
                }
                var links = panorama.getLinks();
                for (var i in links) {
                    var row = document.createElement('tr');
                    linksTable.appendChild(row);
                    var labelCell = document.createElement('td');
                    labelCell.innerHTML = '<b>Link: ' + i + '</b>';
                    var valueCell = document.createElement('td');
                    valueCell.innerHTML = links[i].description;
                    linksTable.appendChild(labelCell);
                    linksTable.appendChild(valueCell);
                }
            });
            panorama.addListener('position_changed', function () {
                var positionCell = document.getElementById('position-cell');
                var positionCellLatitude = document.getElementById('lat-cell');
                var positionCellLongitude = document.getElementById('lng-cell');
                positionCell.firstChild.nodeValue = panorama.getPosition() + '';
                positionCellLatitude.firstChild.nodeValue = panorama.getPosition().lat() + '';
                positionCellLongitude.firstChild.nodeValue = panorama.getPosition().lng() + '';
            });
            panorama.addListener('pov_changed', function () {
                var headingCell = document.getElementById('heading-cell');
                var pitchCell = document.getElementById('pitch-cell');
                headingCell.firstChild.nodeValue = panorama.getPov().heading + '';
                pitchCell.firstChild.nodeValue = panorama.getPov().pitch + '';

                window.setTimeout(function () {
                    rotatedPanoramp();
                }, 3000);
            });

        }


        function rotatedPanoramp() {
            var transform = $(".gm-compass button[jstcache~=39]");
            var headingVal = document.getElementById('heading-cell').innerHTML;


            function getRotationDegrees(obj) {
                var matrix = obj.css("-webkit-transform") ||
                obj.css("-moz-transform") ||
                obj.css("-ms-transform") ||
                obj.css("-o-transform") ||
                obj.css("transform");
                if (matrix !== 'none') {
                    var values = matrix.split('(')[1].split(')')[0].split(',');
                    var a = values[0];
                    var b = values[1];
                    var angle = Math.round(Math.atan2(b, a) * (180 / Math.PI));

                   //  alert("angle " + angle + " headingVal " + headingVal);

                } else { var angle = 0; }
                return (angle < 0) ? angle + 360 : angle;
            }

            angle1 = getRotationDegrees(transform);
        }



        function geocodeAddress(geocoder, resultsMap) {
            var address = document.getElementById('address').value;
            geocoder.geocode({ 'address': address }, function (results, status) {
                if (status === google.maps.GeocoderStatus.OK) {
                    resultsMap.setCenter(results[0].geometry.location);
                    var marker = new google.maps.Marker({
                        map: resultsMap,
                        position: results[0].geometry.location
                    });
                    // Set the initial Street View camera to the center of the map
                    sv.getPanorama({ location: results[0].geometry.location, radius: 50 }, processSVData);
                    streetviewLocation = results[0].geometry.location;

                    var loc = document.getElementById('location-cell');
                    var latitude = results[0].geometry.location.lat();
                    var longitude = results[0].geometry.location.lng();
                   // // alert(latitude + " " + longitude);
                    var latlng = new google.maps.LatLng(latitude, longitude);
                    geocoder.geocode({ 'latLng': latlng }, function (results, status) {
                        if (status == google.maps.GeocoderStatus.OK) {
                            if (results[1]) {
                                //// alert("Location: " + results[1].formatted_address);
                                loc.innerHTML = results[1].formatted_address;

                            }
                        }
                    });
                } else {
                    //// // alert('Geocode was not successful for the following reason: ' + status);
                }
            });
        }



        function processSVData(data, status) {
            if (status === google.maps.StreetViewStatus.OK) {
                var marker = new google.maps.Marker({
                    position: data.location.latLng,
                    map: map,
                    title: data.location.description
                });
                panorama.setPano(data.location.pano);
                panorama.setPov({
                    heading: 0,
                    pitch: 0
                });
                panorama.setVisible(true);
                marker.addListener('click', function () {
                    var markerPanoID = data.location.pano;
                    // Set the Pano to use the passed panoID.
                    panorama.setPano(markerPanoID);
                    panorama.setPov({
                        heading: 270,
                        pitch: 0
                    });
                    panorama.setVisible(true);
                });
            } else {
                console.error('Street View data not found for this location.');
            }
        }
        document.getElementById('address').addEventListener('keyup', function (event) {
            if (event.keyCode == 13) {
                document.getElementById('submit').click();
            }
        });
        document.getElementById('address').addEventListener('click', function () {
            var apiKey = 'AIzaSyDwv3jzb9Cc4QD9pRhwgeL4pz8WX6DRpLE';
            var coreURL = 'https://maps.googleapis.com/maps/api/streetview?size=';
            var latitude = document.getElementById('lat-cell').innerHTML;
            var longitude = document.getElementById('lng-cell').innerHTML;
            var location = latitude + ',' + longitude;
            var heading = document.getElementById('heading-cell').innerHTML;
            var pitch = document.getElementById('pitch-cell').innerHTML;
            var imageWidth = '600';
            var imageHeigth = '300';
            // window.location =  coreURL + imageWidth + 'x' + imageHeigth + '&location=' + location +'&heading=' + heading + '&pitch=' + pitch + '&key=' + apiKey;
        });



    </script>



    <script>


            // Translates degrees to meters. It is just a hack, not a proper projection.
            // originLat and originLon should be the "center" of our area of interest or
            // close to it
            function hackMapProjection(lat, lon, originLat, originLon) {
                var lonCorrection = 1.5;
                var rMajor = 6378137.0;

                function lonToX(lon) {
                    return rMajor * (lon * Math.PI / 180);
                }

                function latToY(lat) {
                    if (lat === 0) {
                        return 0;
                    } else {
                        return rMajor * Math.log(Math.tan(Math.PI / 4 + (lat * Math.PI / 180) / 2));
                    }
                }

                var x = lonToX(lon - originLon) / lonCorrection;
                var y = latToY(lat - originLat);
                return {'x': x, 'y': y};
            }


            function latLon2ThreeMeters(lat, lon, worldOrigin) {
                var xy = hackMapProjection(lat, lon, worldOrigin[0], worldOrigin[1]);
                return {'x': xy.x, 'y': 0, 'z': -xy.y};
            }



            function loadWheel ( object ) {
                object.receiveShadow = true;

                var bbox = new THREE.Box3().setFromObject(object);

                var xsize = bbox.max.x - bbox.min.x;
                var ysize = bbox.max.y - bbox.min.y;
                var zsize = bbox.max.z - bbox.min.z;

                // Sizes in meters
                var desiredXSize = 8.0;
                var desiredYSize = 20.0;
                var desiredZSize = 20.0;

                object.scale.set(desiredXSize / xsize, desiredYSize / ysize, desiredZSize / zsize);

                object.position.set(meshPos.x, meshPos.y, meshPos.z); // the parking lot is sligthly under the street level

                object.rotation.set(-Math.PI/2, 0, Math.PI/2);

                // For shadows (given the right ligths, and that renderer enables them)
                object.castShadow = true;

                var streetViewOverlay = StreetViewOverlay();
                // 41.684196,-0.888992 is a street close to the parking lot behind Ada Byron building
                streetViewOverlay.load({streetView: true, objects3D: true, webGL:true}, object, 41.684196, -0.888992, worldOrigin);
            }

            // On the parking lot behind Ada Byron building
            var objectPosition = [41.684561,-0.888864];
            var worldOrigin = [41.684561,-0.888864];
            var meshPos =  {'x': 0, 'y': -2, 'z': 0}; // We take the position of the treeDiv object as the center of the world, so its position will be 0,-2,0

           // var loader = new THREE.TDSLoader( );
          // loader.setPath( 'static/treeDiv/' );
           //loader.load('static/treeDiv/TreeN190616.3ds', loadWheel);
           //loader.load('static/treeDiv/tree_PNG3477.png', loadWheel);

    </script>

</body>
</html>
